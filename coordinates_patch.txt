
# Add this code to the orchestrate_tour_async function right before storing in database
print("\n==== FORCING COORDINATES RETRIEVAL BEFORE DATABASE STORAGE ====\n")
print(f"Location: {location}")

# Call the coordinates-fromai service directly
try:
    import requests
    import urllib.parse
    
    # URL-encode the location
    encoded_location = urllib.parse.quote(location)
    
    # Make the request to the coordinates-fromai service
    url = f"http://coordinates-fromai:5004/coordinates/{encoded_location}"
    print(f"Requesting coordinates from: {url}")
    
    response = requests.get(url, timeout=30)
    
    print(f"Response status code: {response.status_code}")
    
    if response.status_code == 200:
        data = response.json()
        
        if "coordinates" in data and len(data["coordinates"]) >= 2:
            lat, lng = data["coordinates"][0], data["coordinates"][1]
            print(f"Received coordinates: lat={lat}, lng={lng}")
            # Override any previous coordinates
            coordinates = [lat, lng]
        else:
            print(f"Invalid response format: {data}")
    else:
        print(f"Error response: {response.text}")
except Exception as e:
    print(f"Error calling coordinates service: {e}")
